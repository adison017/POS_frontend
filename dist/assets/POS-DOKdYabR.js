import{r as g,j as e,y as N,_ as fe}from"./index-C7VodmU4.js";import{getPaymentMethods as se,getMenuCategories as ye,getMenuItems as je,getLatestOrderNo as ve,getOrders as we,getOrderItems as Ne,createOrder as ke,createOrderItem as Me,updateOrder as Ce}from"./dataService-DioIbMCu.js";import{s as _e}from"./socket-BBuNZ37k.js";import"./apiClient-CgrKIHeM.js";const Se="/assets/logo-DyMH3iep.png",Re=()=>{const[T,U]=g.useState("all"),[h,F]=g.useState({items:[],subtotal:0,discount:0,grandTotal:0}),[$,R]=g.useState(1),[re,ae]=g.useState([]),[P,oe]=g.useState([]),[M,z]=g.useState([]),[k,E]=g.useState(""),[ne,W]=g.useState(!1),[C,H]=g.useState(""),[le,V]=g.useState(!1),[I,ie]=g.useState(""),[D,A]=g.useState([]),de=async(t,n)=>{try{const i=await(await fetch(n,{credentials:"omit"})).blob(),l=URL.createObjectURL(i),s=document.createElement("a");s.href=l,s.download=`${t||"receipt"}.png`,document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(l)}catch(a){console.error("Download receipt failed",a),N.error("ไม่สามารถดาวน์โหลดสลิปได้")}},ce=t=>{try{const n=window.open("","_blank","width=480,height=720");if(!n)return;const a=`<!doctype html><html><head><meta charset="utf-8"><title>Print Receipt</title>
        <style>html,body{margin:0;padding:0;background:#fff} img{max-width:100%;height:auto;display:block;margin:0 auto}</style>
      </head><body><img src="${t}" onload="window.focus();window.print();" /></body></html>`;n.document.open(),n.document.write(a),n.document.close()}catch(n){console.error("Print receipt failed",n),N.error("ไม่สามารถพิมพ์สลิปได้")}},[_,Q]=g.useState("amount"),[f,G]=g.useState("0"),[j,J]=g.useState("0");g.useEffect(()=>{(async()=>{try{const[a,i,l]=await Promise.all([ye(),je(),se()]),s=a?a.filter(m=>m.is_active):[],d=i?i.filter(m=>m.is_active):[];ae(s||[]),oe(d||[]),z(l||[]),l&&l.length>0&&E(l[0].id)}catch(a){console.error("Error loading data:",a),N.error("ไม่สามารถโหลดข้อมูลได้")}})();const n=_e.connectSocket();return n.on("order:updated",async()=>{try{const a=await se();z(a||[])}catch(a){console.error("Error updating payment methods:",a)}}),()=>{n.off("order:updated")}},[]),g.useEffect(()=>{(async()=>{try{const n=await ve();if(n&&n.startsWith("ORD")){const a=parseInt(n.replace("ORD",""));R((isNaN(a)?0:a)+1)}else R(1)}catch(n){console.error("Error loading latest order:",n),R(1)}})()},[]),g.useEffect(()=>{(async()=>{try{const n=await we(),a=await Promise.all(n.map(s=>Ne(s.id))).then(s=>s.flat()),i={};a.forEach(s=>{i[s.item_id]?(i[s.item_id].qty+=Number(s.qty)||0,i[s.item_id].revenue+=Number(s.total_price)||0):i[s.item_id]={id:s.item_id,name:s.name,qty:Number(s.qty)||0,revenue:Number(s.total_price)||0}});const l=Object.values(i).sort((s,d)=>d.qty-s.qty||d.revenue-s.revenue).slice(0,5);A(l)}catch(n){console.error("Error loading top selling items:",n),A([])}})()},[]);const K=T==="all"?P.filter(t=>t.is_active):P.filter(t=>t.category_id===T&&t.is_active),X=(()=>{if(D.length===0)return K;const t={};return D.forEach((n,a)=>{t[n.id]=a+1}),[...K].sort((n,a)=>{const i=t[n.id],l=t[a.id];return i&&l?i-l:i?-1:l?1:0})})(),me=(t,n,a=1)=>{const i=P.find(l=>l.id===t);i&&F(l=>{const s=Number.isFinite(n)?n:parseFloat(n)||i.price,d=Math.max(1,parseInt(a,10)||1),m=`${i.id}__${s}`,o=l.items.find(r=>r.id===m);let c;o?c=l.items.map(r=>r.id===m?{...r,qty:r.qty+d,total:(r.qty+d)*r.price}:r):c=[...l.items,{id:m,baseItemId:i.id,name:i.name,price:s,cost:i.cost_default||0,qty:d,total:s*d}];const y=c.reduce((r,B)=>r+B.total,0),p=_==="percent"?Math.min(y,y*(parseFloat(f)||0)/100):Math.min(y,parseFloat(f)||0),v=Math.max(0,parseFloat(j)||0),S=Math.max(0,y-p+v);return{items:c,subtotal:y,discount:p,grandTotal:S}})},Y=(t,n)=>{F(a=>{let i;n==="increase"?i=a.items.map(o=>o.id===t?{...o,qty:o.qty+1,total:(o.qty+1)*o.price}:o):n==="decrease"&&(i=a.items.map(o=>o.id===t?{...o,qty:o.qty-1,total:(o.qty-1)*o.price}:o).filter(o=>o.qty>0));const l=i.reduce((o,c)=>o+c.total,0),s=_==="percent"?Math.min(l,l*(parseFloat(f)||0)/100):Math.min(l,parseFloat(f)||0),d=Math.max(0,parseFloat(j)||0),m=Math.max(0,l-s+d);return{items:i,subtotal:l,discount:s,grandTotal:m}})},O=(t,n)=>{F(a=>{const i=a.items.map(o=>{if(o.id!==t)return o;const c=Math.max(0,(parseFloat(o.price)||0)+n);return{...o,price:c,total:c*o.qty}}),l=i.reduce((o,c)=>o+c.total,0),s=_==="percent"?Math.min(l,l*(parseFloat(f)||0)/100):Math.min(l,parseFloat(f)||0),d=Math.max(0,parseFloat(j)||0),m=Math.max(0,l-s+d);return{...a,items:i,subtotal:l,discount:s,grandTotal:m}})},Z=()=>{F({items:[],subtotal:0,discount:0,grandTotal:0}),G("0"),J("0"),Q("amount")};g.useEffect(()=>{F(t=>{const n=t.items.reduce((s,d)=>s+d.total,0),a=_==="percent"?Math.min(n,n*(parseFloat(f)||0)/100):Math.min(n,parseFloat(f)||0),i=Math.max(0,parseFloat(j)||0),l=Math.max(0,n-a+i);return{...t,subtotal:n,discount:a,grandTotal:l}})},[_,f,j]);const xe=()=>{h.items.length!==0&&W(!0)},ee=()=>{W(!1),E(M.length>0?M[0].id:"")},he=async()=>{if(h.items.length===0)return;if(!k){N.error("กรุณาเลือกวิธีการชำระเงิน");return}const t=M.find(a=>a.id===k),n=t?.id==="pm_cash"||t?.id==="cash"||t?.name?.toLowerCase?.().includes("cash")||t?.name?.includes("เงินสด");if(n){const a=parseFloat(C||"0");if(!isFinite(a)||a<h.grandTotal){N.error("จำนวนเงินที่รับมาต้องมากกว่าหรือเท่ากับยอดชำระ");return}}try{const a=`ORD${String($).padStart(4,"0")}`,i={id:`order_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,order_no:a,status:"paid",subtotal:h.subtotal,grand_total:h.grandTotal,payment_method:k,branch_id:"branch1",cashier_id:"cashier1",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};if(n){const s=parseFloat(C||"0"),d=Math.max(0,s-h.grandTotal);i.cash_received=s,i.cash_change=d}console.log("Creating order with data:",i);const l=await ke(i);if(console.log("Order result:",l),l.error)throw console.error("Failed to create order:",l.error),N.error("ไม่สามารถสร้างออเดอร์ได้ กรุณาลองใหม่อีกครั้ง"),new Error("Failed to create order: "+l.error.message);for(const s of h.items){const d={id:`order_item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,order_id:l.data.id,item_id:s.baseItemId||s.id,name:s.name,qty:s.qty,unit_price:s.price,total_price:s.total,created_at:new Date().toISOString()};console.log("Creating order item with data:",d);const m=await Me(d);if(console.log("Order item result:",m),m.error)throw console.error("Failed to create order item:",m.error),N.error("ไม่สามารถบันทึกรายการอาหารได้ กรุณาลองใหม่อีกครั้ง"),new Error("Failed to create order item: "+m.error.message)}Z(),R(s=>s+1),W(!1),H("");try{const s=document.createElement("canvas"),d=900,m=1200;s.width=d,s.height=m;const o=s.getContext("2d");o.fillStyle="#F7F7F8",o.fillRect(0,0,d,m);const c=40;o.fillStyle="#FFFFFF",o.fillRect(c,c,d-c*2,m-c*2);const y=(x,b,w="bold 28px ui-sans-serif")=>{o.font=w,o.fillStyle="#111827",o.textAlign="center",o.fillText(x,d/2,b)},p=(x,b,w,L="16px ui-sans-serif")=>{o.font=L,o.fillStyle="#111827",o.textAlign="left",o.fillText(x,b,w)},v=(x,b,w,L="16px ui-sans-serif")=>{o.font=L,o.fillStyle="#111827",o.textAlign="right",o.fillText(x,b,w)},S=x=>{o.strokeStyle="#E5E7EB",o.lineWidth=1,o.beginPath(),o.moveTo(c+20,x),o.lineTo(d-c-20,x),o.stroke()};let r=c+30;const B=await new Promise(x=>{const b=new Image;b.src=Se,b.onload=()=>x(b)}),q=140;o.drawImage(B,d/2-q/2,r,q,q),r+=q+20,y("POS-By-adison",r,"700 30px ui-sans-serif"),r+=34,y("123 ถนนหลัก เมืองหนองบัวลำภู จังหวัดหนองบัวลำภู 39000",r,"16px ui-sans-serif"),r+=22,y("โทร: 089-123-4567",r,"16px ui-sans-serif"),r+=30,S(r),r+=24,p(`เลขที่ออร์เดอร์: ${a}`,c+60,r,"600 18px ui-sans-serif"),v(new Date().toLocaleString("th-TH"),d-c-60,r,"16px ui-sans-serif"),r+=26;const pe=t?.name||k;if(p(`วิธีชำระเงิน: ${pe}`,c+60,r),r+=26,t&&(t.id==="pm_cash"||t.id==="cash"||t.name?.includes("เงินสด")||t.name?.toLowerCase?.().includes("cash"))){const x=parseFloat(C||"0"),b=Math.max(0,x-h.grandTotal);p(`ยอดรับเงิน: ${u(x)}`,c+60,r),r+=24,p(`เงินทอน: ${u(b)}`,c+60,r),r+=24}r+=6,S(r),r+=24,p("รายการ",c+60,r,"600 16px ui-sans-serif"),v("รวม",d-c-60,r,"600 16px ui-sans-serif"),r+=22,h.items.forEach(x=>{p(`${x.name} x${x.qty} @${u(x.price)}`,c+60,r),v(`${u(x.total)}`,d-c-60,r),r+=22}),r+=6,S(r),r+=24,p("ยอดรวม",c+60,r,"600 18px ui-sans-serif"),v(`${u(h.subtotal)}`,d-c-60,r,"600 18px ui-sans-serif"),r+=26,p("ส่วนลด",c+60,r),v(`-${u(h.discount)}`,d-c-60,r),r+=22;const be=Math.max(0,parseFloat(j)||0);p("ค่าอื่น ๆ",c+60,r),v(`${u(be)}`,d-c-60,r),r+=26,S(r),r+=30,p("ยอดสุทธิ",c+60,r,"700 22px ui-sans-serif"),v(`${u(h.grandTotal)}`,d-c-60,r,"700 22px ui-sans-serif"),r+=36,y("ขอบคุณที่อุดหนุนครับ/ค่ะ ❤️",r+10,"600 18px ui-sans-serif");const te=await new Promise(x=>s.toBlob(x,"image/png"));if(te){const x=new FormData;x.append("file",new File([te],`${a}.png`,{type:"image/png"})),x.append("folder","receipts");const w=(await(await fe(async()=>{const{default:L}=await import("./apiClient-CgrKIHeM.js");return{default:L}},[])).default.post("/storage/upload",x,{headers:{"Content-Type":"multipart/form-data"}}))?.data?.publicUrl;w&&(await Ce(l.data.id,{receipt_url:w}),ie(w),V(!0))}}catch(s){console.error("Receipt upload error:",s)}N.success("ชำระเงินเรียบร้อยแล้ว!")}catch(a){console.error("Payment processing error:",a),N.error("เกิดข้อผิดพลาดในการชำระเงิน กรุณาลองใหม่อีกครั้ง")}},u=t=>`฿${t.toFixed(2)}`,ge=t=>D.some(n=>n.id===t),ue=t=>{const n=D.findIndex(a=>a.id===t);return n>=0?n+1:null};return e.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-gray-50 to-gray-100 p-2 sm:p-4",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 mb-1 sm:mb-2",children:"ระบบขายหน้าร้าน (POS)"}),e.jsx("p",{className:"text-gray-600 text-sm sm:text-base",children:"จัดการออเดอร์และชำระเงินอย่างรวดเร็ว"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 h-full",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-4 sm:p-6 h-full",children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800 mb-3 sm:mb-4",children:"เมนูอาหาร"}),e.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>U("all"),className:`px-3 py-2 sm:px-4 sm:py-2.5 rounded-xl text-sm font-semibold transition-all duration-300 ${T==="all"?"bg-indigo-500 text-white shadow-md shadow-indigo-200":"bg-white text-gray-700 border border-gray-200 hover:border-indigo-300 hover:bg-indigo-50"}`,children:"ทั้งหมด"}),re.map(t=>e.jsx("button",{onClick:()=>U(t.id),className:`px-3 py-2 sm:px-4 sm:py-2.5 rounded-xl text-sm font-semibold transition-all duration-300 ${T===t.id?"bg-indigo-500 text-white shadow-md shadow-indigo-200":"bg-white text-gray-700 border border-gray-200 hover:border-indigo-300 hover:bg-indigo-50"}`,children:t.name},t.id))]})]}),X.length===0?e.jsxs("div",{className:"text-center py-12 sm:py-16",children:[e.jsx("div",{className:"text-gray-300 mb-4",children:e.jsx("svg",{className:"w-16 h-16 sm:w-20 sm:h-20 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})})}),e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-600 mb-2",children:"ไม่มีรายการเมนู"}),e.jsx("p",{className:"text-gray-500 text-sm sm:text-base",children:'กรุณาเพิ่มเมนูในหน้า "เมนู"'})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-4 max-h-[calc(100vh-300px)] sm:max-h-[calc(100vh-280px)] overflow-y-auto pr-2 custom-scrollbar",children:X.map(t=>e.jsxs("button",{onClick:()=>me(t.id),className:"bg-gradient-to-br from-white to-gray-50 rounded-2xl p-3 sm:p-4 text-left border border-gray-200 hover:border-indigo-300 hover:shadow-xl transition-all duration-300 group relative overflow-hidden flex flex-col h-full transform hover:-translate-y-1",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl"}),ge(t.id)&&e.jsxs("div",{className:"absolute top-2 right-2 bg-amber-500 text-white text-xs font-bold px-2 py-1 rounded-full z-20",children:["ขายดีอันดับ ",ue(t.id)]}),t.image_url?e.jsxs("div",{className:"relative overflow-hidden rounded-xl mb-2 sm:mb-3",children:[e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-24 sm:h-32 object-cover group-hover:scale-110 transition-transform duration-500"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}):e.jsxs("div",{className:"w-full h-24 sm:h-32 bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl mb-2 sm:mb-3 flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-100 to-gray-200"}),e.jsx("svg",{className:"w-8 h-8 sm:w-12 sm:h-12 text-gray-300 relative z-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})]}),e.jsxs("div",{className:"relative z-10 flex flex-col flex-grow",children:[e.jsx("h3",{className:"font-semibold text-gray-800 group-hover:text-indigo-600 text-sm leading-tight mb-2 line-clamp-2 flex-grow",children:t.name}),e.jsxs("div",{className:"mt-auto pt-1 sm:pt-2 flex items-center justify-between",children:[e.jsx("span",{className:"font-bold text-base sm:text-lg text-emerald-600 whitespace-nowrap truncate block",children:u(t.price)}),e.jsx("div",{className:"bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:"เพิ่ม"})]})]})]},t.id))})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-4 sm:p-6 h-full flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800",children:"ออเดอร์ปัจจุบัน"}),h.items.length>0&&e.jsxs("div",{className:"bg-gradient-to-r from-indigo-500 to-indigo-600 text-white px-2 py-1 sm:px-3 sm:py-1.5 rounded-full text-xs sm:text-sm font-bold shadow-md",children:["#",`ORD${String($).padStart(4,"0")}`]})]}),h.items.length===0?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center py-8 sm:py-12",children:[e.jsx("div",{className:"text-gray-200 mb-4 sm:mb-6",children:e.jsx("svg",{className:"w-16 h-16 sm:w-24 sm:h-24 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-600 mb-1 sm:mb-2",children:"ยังไม่มีรายการ"}),e.jsx("p",{className:"text-gray-500 mb-3 sm:mb-4 text-sm sm:text-base",children:"เพิ่มรายการจากเมนูด้านซ้าย"}),e.jsx("div",{className:"text-gray-400 text-xs sm:text-sm",children:"คลิกที่เมนูอาหารเพื่อเพิ่มลงในออเดอร์"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-1 overflow-y-auto pr-1 sm:pr-2 custom-scrollbar mb-4 sm:mb-6",children:h.items.map(t=>e.jsxs("div",{className:"p-3 sm:p-4 bg-gray-50 rounded-xl mb-2 sm:mb-3 last:mb-0 border border-gray-100 hover:border-gray-200 transition-colors duration-200",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 sm:gap-3",children:[e.jsx("h3",{className:"font-semibold text-gray-800 truncate pr-2 flex-1 min-w-0 text-sm sm:text-base",children:t.name}),e.jsx("span",{className:"font-bold text-gray-800 text-base sm:text-lg whitespace-nowrap",children:u(t.total)})]}),e.jsxs("div",{className:"mt-2 sm:mt-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between sm:justify-start gap-2 sm:gap-3",children:[e.jsxs("span",{className:"text-xs sm:text-sm text-gray-500 whitespace-nowrap",children:[u(t.price)," × ",t.qty]}),e.jsxs("div",{className:"flex items-center bg-white border border-gray-200 rounded-lg sm:rounded-xl overflow-hidden",children:[e.jsx("button",{onClick:()=>Y(t.id,"decrease"),className:"p-1.5 sm:p-2 text-gray-600 hover:bg-gray-100 transition-colors duration-200","aria-label":"decrease quantity",children:e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M20 12H4"})})}),e.jsx("span",{className:"px-2 sm:px-3 py-1 text-xs sm:text-sm font-bold text-gray-700 min-w-6 sm:min-w-8 text-center",children:t.qty}),e.jsx("button",{onClick:()=>Y(t.id,"increase"),className:"p-1.5 sm:p-2 text-gray-600 hover:bg-gray-100 transition-colors duration-200","aria-label":"increase quantity",children:e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})})]})]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-1 justify-end sm:justify-start",children:[e.jsx("span",{className:"text-xs text-gray-400 mr-1",children:"ปรับราคา:"}),e.jsx("button",{onClick:()=>O(t.id,-10),className:"px-1.5 py-0.5 sm:px-2 sm:py-1 text-xs bg-white hover:bg-gray-100 rounded border border-gray-200",children:"-10"}),e.jsx("button",{onClick:()=>O(t.id,-5),className:"px-1.5 py-0.5 sm:px-2 sm:py-1 text-xs bg-white hover:bg-gray-100 rounded border border-gray-200",children:"-5"}),e.jsx("button",{onClick:()=>O(t.id,5),className:"px-1.5 py-0.5 sm:px-2 sm:py-1 text-xs bg-white hover:bg-gray-100 rounded border border-gray-200",children:"+5"}),e.jsx("button",{onClick:()=>O(t.id,10),className:"px-1.5 py-0.5 sm:px-2 sm:py-1 text-xs bg-white hover:bg-gray-100 rounded border border-gray-200",children:"+10"})]})]})]},t.id))}),e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-4 sm:p-6 mb-4 sm:mb-6 border border-gray-200",children:e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 text-sm sm:text-base",children:"รวมย่อย:"}),e.jsx("span",{className:"font-semibold text-gray-800 text-sm sm:text-base",children:u(h.subtotal)})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700",children:"ส่วนลด"}),e.jsxs("div",{className:"flex items-stretch gap-2",children:[e.jsx("input",{type:"number",step:"0.01",value:f,onChange:t=>G(t.target.value),className:"flex-1 min-w-0 px-2 py-1.5 sm:px-3 sm:py-2 border border-gray-300 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm",placeholder:"0"}),e.jsxs("select",{value:_,onChange:t=>Q(t.target.value),className:"px-2 py-1.5 sm:px-3 sm:py-2 border border-gray-300 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm","aria-label":"หน่วยส่วนลด",children:[e.jsx("option",{value:"amount",children:"บาท"}),e.jsx("option",{value:"percent",children:"%"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700",children:"ค่าอื่น ๆ"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",step:"0.01",value:j,onChange:t=>J(t.target.value),className:"flex-1 min-w-0 px-2 py-1.5 sm:px-3 sm:py-2 border border-gray-300 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm",placeholder:"เช่น ค่าบริการ"}),e.jsx("span",{className:"text-gray-600 text-xs sm:text-sm",children:"บาท"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 text-sm sm:text-base",children:"ส่วนลด:"}),e.jsxs("span",{className:"font-semibold text-red-500 text-sm sm:text-base",children:["-",u(h.discount)]})]}),parseFloat(j)>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 text-sm sm:text-base",children:"ค่าอื่น ๆ:"}),e.jsx("span",{className:"font-semibold text-gray-800 text-sm sm:text-base",children:u(Math.max(0,parseFloat(j)||0))})]}),e.jsx("div",{className:"border-t border-gray-300 pt-2 sm:pt-3 mt-1 sm:mt-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-base sm:text-lg font-bold text-gray-800",children:"รวมทั้งหมด:"}),e.jsx("span",{className:"text-xl sm:text-2xl font-bold text-emerald-600",children:u(h.grandTotal)})]})})]})}),e.jsxs("div",{className:"flex space-x-2 sm:space-x-3",children:[e.jsx("button",{onClick:Z,className:"flex-1 py-3 sm:py-4 px-4 sm:px-6 bg-gradient-to-br from-gray-100 to-gray-200 text-gray-700 rounded-xl font-bold hover:from-gray-200 hover:to-gray-300 transition-all duration-300 shadow hover:shadow-md border border-gray-200 text-sm sm:text-base",children:"ล้างออเดอร์"}),e.jsx("button",{onClick:xe,className:"flex-1 py-3 sm:py-4 px-4 sm:px-6 bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white rounded-xl font-bold transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 text-sm sm:text-base",children:"ชำระเงิน"})]})]})]})})]})]}),ne&&e.jsx("div",{className:"fixed inset-0 bg-white/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md transform animate-scale-in border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:"ชำระเงิน"}),e.jsx("button",{onClick:ee,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200 p-2 hover:bg-gray-100 rounded-xl",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-500 to-indigo-600 text-white rounded-2xl p-6 mb-6 text-center",children:[e.jsx("div",{className:"text-sm opacity-90 mb-1",children:"ออเดอร์ #"}),e.jsx("div",{className:"text-2xl font-bold mb-2",children:`ORD${String($).padStart(4,"0")}`}),e.jsx("div",{className:"text-3xl font-bold",children:u(h.grandTotal)})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-4",children:"เลือกวิธีการชำระเงิน"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:M.map(t=>e.jsx("button",{onClick:()=>E(t.id),className:`p-4 rounded-xl border-2 text-center transition-all duration-300 ${k===t.id?"border-indigo-500 bg-indigo-50 text-indigo-700 font-bold shadow-md scale-105":"border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 text-gray-700"}`,children:t.name},t.id))})]}),(()=>{const t=M.find(m=>m.id===k);if(!(t?.id==="pm_cash"||t?.id==="cash"||t?.name?.toLowerCase?.().includes("cash")||t?.name?.includes("เงินสด")))return null;const a=parseFloat(C||"0"),i=isFinite(a)?Math.max(0,a-h.grandTotal):0,l=isFinite(a)&&a>=h.grandTotal,s=l?"bg-emerald-50 border-emerald-200":"bg-amber-50 border-amber-200",d=l?"text-emerald-700":"text-amber-700";return e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"รับเงินมา"}),e.jsxs("div",{className:"flex items-stretch gap-2",children:[e.jsx("input",{type:"number",step:"0.01",value:C,onChange:m=>H(m.target.value),className:"flex-1 min-w-0 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"0.00"}),e.jsx("span",{className:"px-3 py-2 text-gray-600 bg-gray-50 border border-gray-200 rounded-lg",children:"บาท"})]}),e.jsxs("div",{className:`mt-3 flex items-center justify-between rounded-xl px-4 py-3 border ${s}`,children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-gray-700",children:[e.jsx("svg",{className:`w-5 h-5 ${l?"text-emerald-600":"text-amber-600"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:l?"เงินทอน":"รับเงินไม่พอ"})]}),e.jsx("span",{className:`font-extrabold text-2xl ${d}`,children:u(i)})]})]})})()]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:ee,className:"flex-1 py-4 px-6 bg-gradient-to-br from-gray-100 to-gray-200 text-gray-700 rounded-xl font-bold hover:from-gray-200 hover:to-gray-300 transition-all duration-300 shadow border border-gray-200",children:"ยกเลิก"}),e.jsx("button",{onClick:he,className:"flex-1 py-4 px-6 bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white rounded-xl font-bold transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",disabled:(()=>{const t=M.find(i=>i.id===k);if(!(t?.id==="pm_cash"||t?.id==="cash"||t?.name?.toLowerCase?.().includes("cash")||t?.name?.includes("เงินสด")))return!1;const a=parseFloat(C||"0");return!(isFinite(a)&&a>=h.grandTotal)})(),children:"ยืนยันการชำระ"})]})]})}),le&&I&&e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-[1px] flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-4 w-full max-w-xl border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"สลิปการชำระเงิน"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ce(I),className:"px-3 py-1.5 text-sm bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-bold",children:"พิมพ์"}),e.jsx("button",{onClick:()=>de(`receipt_${String($-1).padStart(4,"0")}`,I),className:"px-3 py-1.5 text-sm bg-white hover:bg-gray-50 text-gray-700 rounded-lg border border-gray-200 font-bold",children:"ดาวน์โหลด"}),e.jsx("a",{href:I,target:"_blank",rel:"noreferrer",className:"px-3 py-1.5 text-sm bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-bold",children:"เปิดในแท็บใหม่"}),e.jsx("button",{onClick:()=>V(!1),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg","aria-label":"close receipt",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("div",{className:"max-h-[70vh] overflow-auto",children:e.jsx("img",{src:I,alt:"receipt",className:"w-full h-auto rounded-lg border border-gray-200"})})]})}),e.jsx("style",{children:`
        .custom-scrollbar::-webkit-scrollbar {
          width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: #f1f5f9;
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: #cbd5e1;
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: #94a3b8;
        }
        .animate-scale-in {
          animation: scaleIn 0.2s ease-out;
        }
        @keyframes scaleIn {
          from {
            opacity: 0;
            transform: scale(0.9);
          }
          to {
            opacity: 1;
            transform: scale(1);
          }
        }
      `})]})};export{Re as default};
